# Browser-Rendering-Process

> - created by 허재혁(jack2ee)
> - created at 210426

## 렌더링 순서

DOM, CSSOM 그리고 Render-Tree에 대해 알고 있다면([참고링크](../DOM-CSSOM-Render_Tree/README.md)) 브라우저가 이 세개를 이용하여 웹 사이트를 렌더링하는 방식에 대해 알아보자.

웹 페이지가 로드될 때, 브라우저는 HTML 텍스트를 읽고 DOM 트리를 구조화한다. 그 다음, 웹 페이지는 CSS로 CSSOM 트리를 구조화한다.

이 후 두 트리로 Render 트리를 형성한다. Render 트리가 만들어지면 브라우저는 스크린에 각 요소를 그리기 시작한다.

### 레이아웃 과정

브라우저는 각각의 Render 트리 노드의 레이아웃을 만들어낸다. 각 레이아웃은 각 노드의 크기를 해당 요소가 스크린에 그려질 부분에 픽셀 단위로 그려진다. 이 과정은 브라우저가 각 노드의 레이아웃 정보를 계산하므로 **레이아웃 과정** 이라 불린다.

이 과정은 또한 **reflow** 혹은 **browser reflow** 라고 불리고, 이 과정은 우리가 사이트 스크롤, 사이트 크기 조절 뿐만 아니라 DOM 요소를 조작할 때도 일어난다. 다음이 각 요소의 레이아웃/reflow를 유발하는 이벤트들이다.

- DOM에서 요소를 추가, 삭제, 업데이트 하는 경우
- 페이지의 컨텐츠를 변경하는 경우. 예시) input box안에 텍스트를 변경할 경우
- DOM 요소를 이동하는 경우
- DOM 요소에 애니메이션 효과를 줄 때
- offsetHeight 혹은 getComputedStyle과 같이 요소의 길이 등을 잴 때
- CSS 스타일을 바꿀 때
- 요소의 클래스 명을 바꿀 떄
- 스타일 시트를 추가하거나 삭제할 때
- 창을 크기 조절할 때
- 스크롤할 때

### 스타일 적용과정

레이아웃 과정이 끝난 후 Render-Tree 안의 요소들이 서로 겹쳐지고 애니메이션 효과와 같이 요소의 모습과 위치 등을 자주 바꾸는 CSS 속성이 있을 수 있으므로 브라우저는 이를 효과적으로 처리하기 위해 *계층*을 형성한다.

계층을 만드는 것은 브라우저를 스크롤하거나 크기를 재조정하는 것과 같이 전 웹 페이지 라이프사이상의 스타일 변경을 효율적으로 수행할 수 있도록 도와준다.
계층을 갖는 것은 개발자에 의해 의도된 순서에 따라 요소를 정확하게 그리는 데 도움이 된다.

그러나 브라우저는 한번에 모든 계층을 그리지는 않는다. 각 계층은 개별적으로 그려진다.

각 계층에서 브라우저는 border, 배경 색, 그림자 효과, 텍스트와 같은 눈에 보이는 속성이 차지하는 픽셀을 채운다.
이 과정을 *레스터화(rasterization)* 이라고 부른다. 성능을 높이기 위해 브라우저는 이 레스터화를 수행하기 위한 여러개의 쓰레드를 사용한다.

### 합성 과정

스타일 적용과정을 거친 후 화면상에서 특정 순서에 따라 여러 개의 계층(*bitmap images*)을 그려야 한다. *합성(compositing)* 과정을 거치면서 이 계층은 최종 화면에 그리기 위해 GPU로 전송된다.

모든 계층을 보내는 것은 보낼 때마다 매번 *reflow(layout)* 혹은 *repaint* 과정을 거치기 때문에 비효울적이다. 그래서 한 계층은 화면상에 그려질 다수의 타일로 나누어진다.
이는 크롬의 개발자 도구 Rendering 패널에서 확인할 수 있다.
